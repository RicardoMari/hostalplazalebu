<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOSTAL PLAZA LEBU</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        .calendar-day {
            min-height: 80px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 4px;
            background: white;
            font-size: 12px;
        }
        .calendar-day.today {
            background: #fbbf24;
            color: white;
            font-weight: bold;
        }
        .reserva-item {
            font-size: 11px;
            font-weight: bold;
            color: white;
            padding: 3px 2px;
            margin: 1px 0;
            border-radius: 4px;
            text-align: center;
            line-height: 1.2;
        }
        .hab-1 { background: #ef4444; }
        .hab-2 { background: #3b82f6; }
        .hab-3 { background: #10b981; }
        .hab-4 { background: #f59e0b; }
        .hab-5 { background: #8b5cf6; }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            border-radius: 12px;
            padding: 24px;
            margin: 20px;
        }
        @media (max-width: 768px) {
            .calendar-day {
                min-height: 70px;
                font-size: 10px;
            }
            .reserva-item {
                font-size: 10px;
                padding: 2px 1px;
            }
            .modal-content {
                max-width: 95%;
                padding: 16px;
                margin: 10px;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4 max-w-6xl">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-lg mb-6 text-center">
            <h1 class="text-3xl font-bold mb-2"><i class="fas fa-hotel mr-2"></i>HOSTAL PLAZA LEBU</h1>
            <p class="text-lg">Sistema de Gestión de Reservas</p>
        </div>

        <!-- Navigation -->
        <div class="bg-white rounded-lg shadow-lg mb-6 overflow-hidden">
            <div class="flex">
                <button onclick="showPage('calendario')" class="nav-tab flex-1 py-4 px-2 text-sm font-semibold bg-blue-500 text-white">
                    <i class="fas fa-calendar mr-1"></i>Calendario
                </button>
                <button onclick="showPage('lista')" class="nav-tab flex-1 py-4 px-2 text-sm font-semibold bg-gray-200 text-gray-700">
                    <i class="fas fa-list mr-1"></i>Lista
                </button>
                <button onclick="showPage('disponibilidad')" class="nav-tab flex-1 py-4 px-2 text-sm font-semibold bg-gray-200 text-gray-700">
                    <i class="fas fa-home mr-1"></i>Disponibilidad
                </button>
                <button onclick="showPage('estadisticas')" class="nav-tab flex-1 py-4 px-2 text-sm font-semibold bg-gray-200 text-gray-700">
                    <i class="fas fa-chart-bar mr-1"></i>Estadísticas
                </button>
            </div>
        </div>

        <!-- Página Calendario -->
        <div id="calendario" class="page active">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800"><i class="fas fa-calendar-alt mr-2"></i>Calendario de Reservas</h2>
                    <button onclick="openModal('nuevaReserva')" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-semibold">
                        <i class="fas fa-plus mr-2"></i>Nueva Reserva
                    </button>
                </div>
                
                <div class="mb-4 flex justify-between items-center">
                    <button onclick="cambiarMes(-1)" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h3 id="mesActual" class="text-xl font-semibold text-gray-800"></h3>
                    <button onclick="cambiarMes(1)" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>

                <div class="calendar-grid mb-4">
                    <div class="text-center font-bold text-gray-600 py-2 bg-gray-100 rounded">LUN</div>
                    <div class="text-center font-bold text-gray-600 py-2 bg-gray-100 rounded">MAR</div>
                    <div class="text-center font-bold text-gray-600 py-2 bg-gray-100 rounded">MIÉ</div>
                    <div class="text-center font-bold text-gray-600 py-2 bg-gray-100 rounded">JUE</div>
                    <div class="text-center font-bold text-gray-600 py-2 bg-gray-100 rounded">VIE</div>
                    <div class="text-center font-bold text-gray-600 py-2 bg-gray-100 rounded">SÁB</div>
                    <div class="text-center font-bold text-gray-600 py-2 bg-gray-100 rounded">DOM</div>
                </div>
                
                <div id="calendarioDias" class="calendar-grid"></div>
            </div>
        </div>

        <!-- Página Lista -->
        <div id="lista" class="page hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800"><i class="fas fa-list-ul mr-2"></i>Lista de Reservas</h2>
                    <div class="space-x-2">
                        <button onclick="exportarDatos()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-download mr-2"></i>Exportar
                        </button>
                        <button onclick="importarDatos()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-upload mr-2"></i>Importar
                        </button>
                    </div>
                </div>
                
                <div class="mb-4">
                    <input type="text" id="buscarReserva" placeholder="Buscar por nombre, habitación o fecha..." 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           oninput="filtrarReservas()">
                </div>
                
                <div id="listaReservas" class="space-y-4"></div>
            </div>
        </div>

        <!-- Página Disponibilidad -->
        <div id="disponibilidad" class="page hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6"><i class="fas fa-bed mr-2"></i>Disponibilidad de Habitaciones</h2>
                <div id="habitacionesStatus" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </div>
        </div>

        <!-- Página Estadísticas -->
        <div id="estadisticas" class="page hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6"><i class="fas fa-chart-line mr-2"></i>Estadísticas y Respaldos</h2>
                
                <div class="grid md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gradient-to-r from-green-400 to-green-600 text-white p-6 rounded-lg text-center">
                        <i class="fas fa-dollar-sign text-3xl mb-2"></i>
                        <h3 class="text-lg font-semibold">Ingresos del Mes</h3>
                        <p id="ingresosMes" class="text-2xl font-bold">$0</p>
                    </div>
                    <div class="bg-gradient-to-r from-blue-400 to-blue-600 text-white p-6 rounded-lg text-center">
                        <i class="fas fa-percentage text-3xl mb-2"></i>
                        <h3 class="text-lg font-semibold">Ocupación</h3>
                        <p id="ocupacionPromedio" class="text-2xl font-bold">0%</p>
                    </div>
                    <div class="bg-gradient-to-r from-purple-400 to-purple-600 text-white p-6 rounded-lg text-center">
                        <i class="fas fa-users text-3xl mb-2"></i>
                        <h3 class="text-lg font-semibold">Total Reservas</h3>
                        <p id="totalReservas" class="text-2xl font-bold">0</p>
                    </div>
                </div>

                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                    <h3 class="text-lg font-semibold mb-4"><i class="fas fa-save mr-2"></i>Sistema de Respaldos</h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm text-gray-600 mb-2">Último respaldo: <span id="ultimoRespaldo">Nunca</span></p>
                            <div class="space-y-2">
                                <button onclick="crearRespaldoManual()" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                                    <i class="fas fa-save mr-2"></i>Respaldo Manual
                                </button>
                                <button onclick="activarRespaldoAutomatico()" class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                                    <i class="fas fa-clock mr-2"></i>Activar Respaldo Automático
                                </button>
                            </div>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 mb-2">Estado del respaldo automático:</p>
                            <p id="estadoRespaldo" class="text-lg font-semibold text-red-600">Inactivo</p>
                            <input type="file" id="inputImportar" accept=".json" style="display: none;" onchange="procesarImportacion(event)">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nueva Reserva -->
    <div id="nuevaReserva" class="modal">
        <div class="modal-content w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold"><i class="fas fa-plus-circle mr-2"></i>Nueva Reserva</h2>
                <button onclick="closeModal('nuevaReserva')" class="text-gray-500 hover:text-gray-700 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="formReserva" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nombre del Huésped:</label>
                    <input type="text" id="nombreHuesped" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Fecha Entrada:</label>
                        <input type="date" id="fechaEntrada" required min="2024-08-05"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Fecha Salida:</label>
                        <input type="date" id="fechaSalida" required min="2024-08-06"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Habitación:</label>
                    <select id="habitacion" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Seleccionar habitación</option>
                        <option value="1">🔴 Habitación 1 (Roja)</option>
                        <option value="2">🔵 Habitación 2 (Azul)</option>
                        <option value="3">🟢 Habitación 3 (Verde)</option>
                        <option value="4">🟠 Habitación 4 (Naranja)</option>
                        <option value="5">🟣 Habitación 5 (Morada)</option>
                    </select>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Personas:</label>
                        <select id="numPersonas" required 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="1">1 persona</option>
                            <option value="2">2 personas</option>
                            <option value="3">3 personas</option>
                            <option value="4">4 personas</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Precio por Noche:</label>
                        <input type="number" id="precio" placeholder="45000" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Notas:</label>
                    <textarea id="notas" rows="3" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                
                <div class="flex space-x-4">
                    <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-md font-semibold">
                        <i class="fas fa-save mr-2"></i>Guardar
                    </button>
                    <button type="button" onclick="closeModal('nuevaReserva')" 
                            class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-md font-semibold">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Variables globales
        let reservas = JSON.parse(localStorage.getItem('hostalReservas')) || [];
        let fechaActual = new Date();
        let respaldoAutomaticoActivo = localStorage.getItem('respaldoAutomatico') === 'true';
        
        const habitacionesConfig = {
            1: { nombre: 'Habitación 1', color: '#ef4444', emoji: '🔴', clase: 'hab-1' },
            2: { nombre: 'Habitación 2', color: '#3b82f6', emoji: '🔵', clase: 'hab-2' },
            3: { nombre: 'Habitación 3', color: '#10b981', emoji: '🟢', clase: 'hab-3' },
            4: { nombre: 'Habitación 4', color: '#f59e0b', emoji: '🟠', clase: 'hab-4' },
            5: { nombre: 'Habitación 5', color: '#8b5cf6', emoji: '🟣', clase: 'hab-5' }
        };

        // Navegación entre páginas
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('.nav-tab').forEach(t => {
                t.classList.remove('bg-blue-500', 'text-white');
                t.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            document.getElementById(pageId).classList.remove('hidden');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-blue-500', 'text-white');
            
            if(pageId === 'calendario') generarCalendario();
            if(pageId === 'lista') mostrarListaReservas();
            if(pageId === 'disponibilidad') mostrarDisponibilidad();
            if(pageId === 'estadisticas') mostrarEstadisticas();
        }

        // Manejo de modales
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Funciones del calendario
        function cambiarMes(direccion) {
            fechaActual.setMonth(fechaActual.getMonth() + direccion);
            generarCalendario();
        }

        function generarCalendario() {
            const container = document.getElementById('calendarioDias');
            const mesActualElement = document.getElementById('mesActual');
            
            container.innerHTML = '';
            
            const año = fechaActual.getFullYear();
            const mes = fechaActual.getMonth();
            
            const nombresMeses = [
                'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
            ];
            
            mesActualElement.textContent = `${nombresMeses[mes]} ${año}`;
            
            // Primer día del mes
            const primerDia = new Date(año, mes, 1);
            let diaSemana = primerDia.getDay();
            if (diaSemana === 0) diaSemana = 7;
            diaSemana -= 1;
            
            // Días en blanco al inicio
            for (let i = 0; i < diaSemana; i++) {
                const dia = document.createElement('div');
                dia.className = 'calendar-day';
                container.appendChild(dia);
            }
            
            // Días del mes
            const diasEnMes = new Date(año, mes + 1, 0).getDate();
            const hoy = new Date();
            
            for (let dia = 1; dia <= diasEnMes; dia++) {
                const diaElement = document.createElement('div');
                diaElement.className = 'calendar-day';
                
                // Marcar día actual
                if (dia === hoy.getDate() && mes === hoy.getMonth() && año === hoy.getFullYear()) {
                    diaElement.classList.add('today');
                }
                
                diaElement.innerHTML = `<div class="font-bold text-center mb-1">${dia}</div>`;
                
                // Buscar reservas para este día
                const fechaStr = `${año}-${(mes+1).toString().padStart(2,'0')}-${dia.toString().padStart(2,'0')}`;
                const reservasDelDia = reservas.filter(r => {
                    const entrada = new Date(r.fechaEntrada);
                    const salida = new Date(r.fechaSalida);
                    const fecha = new Date(fechaStr);
                    return fecha >= entrada && fecha < salida;
                });
                
                // Mostrar reservas con nombres y números de habitación MÁS GRANDES
                reservasDelDia.forEach(reserva => {
                    const hab = habitacionesConfig[reserva.habitacion];
                    const reservaDiv = document.createElement('div');
                    reservaDiv.className = `reserva-item ${hab.clase}`;
                    // Texto más grande y claro para iPhone
                    reservaDiv.innerHTML = `<div style="font-size: 11px; font-weight: bold;">${reserva.nombreHuesped.split(' ')[0]}</div><div style="font-size: 10px;">Hab. ${reserva.habitacion}</div>`;
                    diaElement.appendChild(reservaDiv);
                });
                
                container.appendChild(diaElement);
            }
        }

        // Lista de reservas
        function mostrarListaReservas() {
            const lista = document.getElementById('listaReservas');
            lista.innerHTML = '';
            
            reservas.forEach((reserva, index) => {
                const hab = habitacionesConfig[reserva.habitacion];
                const reservaDiv = document.createElement('div');
                reservaDiv.className = 'bg-gray-50 p-4 rounded-lg border';
                reservaDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center">
                            <span class="inline-block w-4 h-4 rounded-full mr-2" style="background: ${hab.color}"></span>
                            <h3 class="font-bold text-lg">${reserva.nombreHuesped} - ${hab.nombre}</h3>
                        </div>
                        <button onclick="eliminarReserva(${index})" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <p><strong>Entrada:</strong> ${reserva.fechaEntrada}</p>
                            <p><strong>Salida:</strong> ${reserva.fechaSalida}</p>
                        </div>
                        <div>
                            <p><strong>Personas:</strong> ${reserva.numPersonas}</p>
                            <p><strong>Precio:</strong> $${parseInt(reserva.precio).toLocaleString()}</p>
                        </div>
                    </div>
                    ${reserva.notas ? `<p class="text-gray-600 mt-2"><strong>Notas:</strong> ${reserva.notas}</p>` : ''}
                `;
                lista.appendChild(reservaDiv);
            });
        }

        // Disponibilidad
        function mostrarDisponibilidad() {
            const container = document.getElementById('habitacionesStatus');
            container.innerHTML = '';
            
            const hoy = new Date().toISOString().split('T')[0];
            
            Object.keys(habitacionesConfig).forEach(numHab => {
                const hab = habitacionesConfig[numHab];
                
                const ocupada = reservas.some(r => {
                    const entrada = new Date(r.fechaEntrada);
                    const salida = new Date(r.fechaSalida);
                    const fecha = new Date(hoy);
                    return r.habitacion == numHab && fecha >= entrada && fecha < salida;
                });
                
                const reservaActual = reservas.find(r => {
                    const entrada = new Date(r.fechaEntrada);
                    const salida = new Date(r.fechaSalida);
                    const fecha = new Date(hoy);
                    return r.habitacion == numHab && fecha >= entrada && fecha < salida;
                });
                
                const habDiv = document.createElement('div');
                habDiv.className = `p-6 rounded-lg text-white`;
                habDiv.style.backgroundColor = hab.color;
                habDiv.innerHTML = `
                    <h3 class="text-xl font-bold mb-2">${hab.emoji} ${hab.nombre}</h3>
                    <p class="mb-2"><strong>Estado:</strong> ${ocupada ? '🔴 OCUPADA' : '🟢 DISPONIBLE'}</p>
                    ${ocupada ? `<p><strong>Huésped:</strong> ${reservaActual.nombreHuesped}</p>` : ''}
                    <p><strong>Capacidad:</strong> 1-4 personas</p>
                `;
                container.appendChild(habDiv);
            });
        }

        // Estadísticas
        function mostrarEstadisticas() {
            const mesActual = new Date().getMonth();
            const añoActual = new Date().getFullYear();
            
            const reservasMesActual = reservas.filter(r => {
                const fecha = new Date(r.fechaEntrada);
                return fecha.getMonth() === mesActual && fecha.getFullYear() === añoActual;
            });
            
            const ingresos = reservasMesActual.reduce((total, r) => total + parseInt(r.precio || 0), 0);
            document.getElementById('ingresosMes').textContent = `$${ingresos.toLocaleString()}`;
            
            const diasDelMes = new Date(añoActual, mesActual + 1, 0).getDate();
            const ocupacion = reservasMesActual.length > 0 ? Math.round((reservasMesActual.length / diasDelMes) * 100) : 0;
            document.getElementById('ocupacionPromedio').textContent = `${ocupacion}%`;
            
            document.getElementById('totalReservas').textContent = reservas.length;
            
            // Estado del respaldo
            const ultimoRespaldo = localStorage.getItem('ultimoRespaldo');
            document.getElementById('ultimoRespaldo').textContent = ultimoRespaldo || 'Nunca';
            document.getElementById('estadoRespaldo').textContent = respaldoAutomaticoActivo ? 'Activo' : 'Inactivo';
            document.getElementById('estadoRespaldo').className = respaldoAutomaticoActivo ? 'text-lg font-semibold text-green-600' : 'text-lg font-semibold text-red-600';
        }

        // Funciones de respaldo y exportación
        function exportarDatos() {
            const datos = {
                reservas: reservas,
                fechaExportacion: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(datos, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `hostal_plaza_lebu_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            // Actualizar último respaldo
            localStorage.setItem('ultimoRespaldo', new Date().toLocaleString());
        }

        function importarDatos() {
            document.getElementById('inputImportar').click();
        }

        function procesarImportacion(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const datos = JSON.parse(e.target.result);
                    
                    // Verificar formato
                    if (datos.reservas && Array.isArray(datos.reservas)) {
                        if (confirm(`¿Importar ${datos.reservas.length} reservas? Esto reemplazará los datos actuales.`)) {
                            reservas = datos.reservas;
                            localStorage.setItem('hostalReservas', JSON.stringify(reservas));
                            alert('✅ Datos importados exitosamente');
                            generarCalendario();
                            mostrarListaReservas();
                        }
                    } else {
                        alert('❌ Formato de archivo no compatible');
                    }
                } catch (error) {
                    alert('❌ Error al leer el archivo');
                }
            };
            reader.readAsText(file);
        }

        function crearRespaldoManual() {
            exportarDatos();
        }

        function activarRespaldoAutomatico() {
            respaldoAutomaticoActivo = !respaldoAutomaticoActivo;
            localStorage.setItem('respaldoAutomatico', respaldoAutomaticoActivo.toString());
            
            if (respaldoAutomaticoActivo) {
                alert('✅ Respaldo automático activado. Se ejecutará diariamente a las 23:59.');
                // Configurar respaldo diario
                configurarRespaldoAutomatico();
            } else {
                alert('❌ Respaldo automático desactivado');
            }
            mostrarEstadisticas();
        }

        function configurarRespaldoAutomatico() {
            const ahora = new Date();
            const proximoRespaldo = new Date();
            proximoRespaldo.setHours(23, 59, 0, 0);
            
            if (ahora > proximoRespaldo) {
                proximoRespaldo.setDate(proximoRespaldo.getDate() + 1);
            }
            
            const tiempoHastaRespaldo = proximoRespaldo - ahora;
            
            setTimeout(() => {
                if (respaldoAutomaticoActivo) {
                    exportarDatos();
                    // Programar el siguiente respaldo en 24 horas
                    setInterval(() => {
                        if (respaldoAutomaticoActivo) {
                            exportarDatos();
                        }
                    }, 24 * 60 * 60 * 1000);
                }
            }, tiempoHastaRespaldo);
        }

        // Formulario de nueva reserva
        document.getElementById('formReserva').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const reserva = {
                nombreHuesped: document.getElementById('nombreHuesped').value,
                fechaEntrada: document.getElementById('fechaEntrada').value,
                fechaSalida: document.getElementById('fechaSalida').value,
                habitacion: parseInt(document.getElementById('habitacion').value),
                numPersonas: parseInt(document.getElementById('numPersonas').value),
                precio: parseInt(document.getElementById('precio').value),
                notas: document.getElementById('notas').value,
                fechaCreacion: new Date().toISOString()
            };
            
            reservas.push(reserva);
            localStorage.setItem('hostalReservas', JSON.stringify(reservas));
            
            closeModal('nuevaReserva');
            this.reset();
            generarCalendario();
            alert('✅ Reserva guardada exitosamente');
        });

        // Eliminar reserva
        function eliminarReserva(index) {
            if (confirm('¿Eliminar esta reserva?')) {
                reservas.splice(index, 1);
                localStorage.setItem('hostalReservas', JSON.stringify(reservas));
                mostrarListaReservas();
                generarCalendario();
            }
        }

        // Filtrar reservas
        function filtrarReservas() {
            const busqueda = document.getElementById('buscarReserva').value.toLowerCase();
            mostrarListaReservas();
            
            if (busqueda) {
                const items = document.querySelectorAll('#listaReservas > div');
                items.forEach(item => {
                    const texto = item.textContent.toLowerCase();
                    item.style.display = texto.includes(busqueda) ? 'block' : 'none';
                });
            }
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            generarCalendario();
            
            // Configurar fecha mínima
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('fechaEntrada').min = hoy;
            document.getElementById('fechaSalida').min = hoy;
            
            // Configurar respaldo automático si está activo
            if (respaldoAutomaticoActivo) {
                configurarRespaldoAutomatico();
            }
        });

        // Cerrar modales al hacer clic fuera
        window.onclick = function(event) {
            const modales = document.querySelectorAll('.modal');
            modales.forEach(modal => {
                if (event.target === modal) {
                    modal.classList.remove('active');
                }
            });
        }
    </script>
</body>
</html>
